<style>
  .gefi-workflow-svg {
    /* Use a fixed, smaller max-width for phone view, but let width be 100% */
    width: 100%;
    max-width: 600px; 
    display: block;
    margin: 0 auto;
    overflow: visible;
  }
  .gefi-workflow-wrapper {
    background: transparent;
    padding: 5px 0; /* Reduced padding */
    text-align: center;
  }

  /* Default = dark theme */
  .gefi-node {
    fill: #ffffff;
    stroke: #777777;
    stroke-width: 2;
    rx: 16;
    ry: 16;
  }
  .gefi-text {
    fill: #ffffff;
    font-family: system-ui, -apple-system, sans-serif;
  }
  .gefi-arrow {
    stroke: #bbbbbb;
    stroke-width: 3;
    fill: none;
  }
  .gefi-input-group {
    fill: #4CAF50;
    stroke: #388E3C;
    stroke-width: 2;
    rx: 12;
    ry: 12;
  }
  .gefi-compliance-node {
    fill: #FF9800;
    stroke: #E65100;
  }
  .gefi-feedback-arrow-label {
    fill: #ffffff;
    font-size: 13px;
    font-weight: 500;
    font-family: system-ui, -apple-system, sans-serif;
  }

  /* Light theme override */
  @media (prefers-color-scheme: light) {
    .gefi-node {
      fill: #f0f0f0 !important;
      stroke: #444444 !important;
    }
    .gefi-text {
      fill: #111111 !important;
    }
    .gefi-arrow {
      stroke: #555555 !important;
    }
    .gefi-input-group {
      fill: #DCF8E0 !important;
      stroke: #388E3C !important;
    }
    .gefi-compliance-node {
      fill: #FFF3E0 !important;
      stroke: #E65100 !important;
    }
    .gefi-feedback-arrow-label {
      fill: #111111 !important;
    }
  }
</style>

<div class="gefi-workflow-wrapper">
<svg class="gefi-workflow-svg" viewBox="150 20 600 700" preserveAspectRatio="xMidYMid meet">
  <defs>
    <marker id="arrowhead" markerWidth="3" markerHeight="2.5" refX="2.5" refY="1.25" orient="auto" style="color: currentColor;">
      <path d="M0,0 L2.5,1.25 L0,2.5 Z" style="fill: currentColor;"/>
    </marker>
  </defs>

  <rect x="230" y="40" width="440" height="70" rx="12" class="gefi-input-group" id="stakeholder-node"/>
    <text x="450" y="68" text-anchor="middle" class="gefi-text" style="font-size:19px; font-weight:700;">Stakeholders (Devs + FIs + Data Providers)</text>
    
    <rect x="230" y="140" width="440" height="70" rx="16" class="gefi-node" id="local-agents-node"/>
    <text x="450" y="163" text-anchor="middle" class="gefi-text" style="font-size:18px; font-weight:600;">Local Model Agents</text>
    <text x="450" y="188" text-anchor="middle" class="gefi-text" style="font-size:13px; opacity:0.9;">(Training on private, I-device data)</text>

    <rect x="230" y="240" width="440" height="70" rx="16" class="gefi-node"/>
    <text x="450" y="263" text-anchor="middle" class="gefi-text" style="font-size:18px; font-weight:600;">Federated Learning Orchestrator</text>
    <text x="450" y="288" text-anchor="middle" class="gefi-text" style="font-size:13px; opacity:0.9;">(Manages update cycles & encryption)</text>

    <rect x="230" y="340" width="440" height="70" rx="16" class="gefi-node"/>
    <text x="450" y="363" text-anchor="middle" class="gefi-text" style="font-size:18px; font-weight:600;">Secure Aggregation Layer</text>
    <text x="450" y="388" text-anchor="middle" class="gefi-text" style="font-size:13px; opacity:0.9;">(FedAvg, FedProx, HE, DP, ZKPs)</text>
    
    <rect x="230" y="440" width="215" height="70" rx="16" class="gefi-compliance-node"/>
    <text x="337.5" y="463" text-anchor="middle" class="gefi-text" style="font-size:18px; font-weight:600;">Compliance Engine</text>
    <text x="337.5" y="488" text-anchor="middle" class="gefi-text" style="font-size:13px; opacity:0.9;">(Pre-distribution review)</text>

    <rect x="455" y="440" width="215" height="70" rx="16" class="gefi-compliance-node"/>
    <text x="562.5" y="463" text-anchor="middle" class="gefi-text" style="font-size:18px; font-weight:600;">Regulator Notifier</text>
    <text x="562.5" y="488" text-anchor="middle" class="gefi-text" style="font-size:13px; opacity:0.9;">(Reporting & Auditing)</text>
    
    <rect x="230" y="540" width="440" height="70" rx="16" class="gefi-node"/>
    <text x="450" y="563" text-anchor="middle" class="gefi-text" style="font-size:18px; font-weight:600;">Contribution Ledger</text>
    <text x="450" y="588" text-anchor="middle" class="gefi-text" style="font-size:13px; opacity:0.9;">(Smart Contracts, Provenance, Rating)</text>

    <rect x="230" y="640" width="440" height="70" rx="16" class="gefi-node"/>
    <text x="450" y="663" text-anchor="middle" class="gefi-text" style="font-size:18px; font-weight:600;">GeFi Marketplace</text>
    <text x="450" y="688" text-anchor="middle" class="gefi-text" style="font-size:13px; opacity:0.9;">(Model Exchange, Rewards Distribution)</text>

    
    <line x1="450" y1="110" x2="450" y2="140" class="gefi-arrow" marker-end="url(#arrowhead)"/>
    
    <line x1="450" y1="210" x2="450" y2="240" class="gefi-arrow" marker-end="url(#arrowhead)"/>
    <text x="530" y="230" text-anchor="start" class="gefi-text" style="font-size:13px; opacity:0.8;">Encrypted Updates</text>

    <line x1="450" y1="310" x2="450" y2="340" class="gefi-arrow" marker-end="url(#arrowhead)"/>

    <line x1="450" y1="410" x2="450" y2="440" class="gefi-arrow" marker-end="url(#arrowhead)"/>
    
    <line x1="445" y1="475" x2="455" y2="475" class="gefi-arrow" marker-end="url(#arrowhead)"/>

    <line x1="450" y1="510" x2="450" y2="540" class="gefi-arrow" marker-end="url(#arrowhead)"/>
    
    <line x1="450" y1="610" x2="450" y2="640" class="gefi-arrow" marker-end="url(#arrowhead)"/>


    <path d="M 670 675 
             L 670 700 
             L 700 700 
             L 700 75 
             L 670 75" 
          class="gefi-arrow" marker-end="url(#arrowhead)"/>
    <text x="705" y="380" text-anchor="start" class="gefi-feedback-arrow-label" transform="rotate(90 705 380)">New Global Model & Rewards Distribution</text>

    <path d="M 230 675 
             L 230 700 
             L 200 700 
             L 200 175 
             L 230 175" 
          class="gefi-arrow" marker-end="url(#arrowhead)"/>
    <text x="195" y="380" text-anchor="end" class="gefi-feedback-arrow-label" transform="rotate(-90 195 380)">Model Utilization & Feedback</text>

</svg>
</div>