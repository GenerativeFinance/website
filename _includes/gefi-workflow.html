<!-- Fixed, fully visible, responsive SVG workflow diagram with bidirectional loop arrows -->
<style>
  .gefi-workflow-svg {
    width: 100%;
    max-width: 1000px;
    display: block;
    margin: 0 auto;
  }
  .gefi-workflow-wrapper {
    background: transparent;
    padding: 40px 0;
    text-align: center;
  }

  /* Default = dark theme (matches the screenshots) */
  .gefi-node {
    fill: #ffffff;
    stroke: #777777;
    stroke-width: 2;
    rx: 16;
    ry: 16;
  }
  .gefi-text {
    fill: #ffffff;
    font-family: system-ui, -apple-system, sans-serif;
  }
  .gefi-arrow {
    stroke: #bbbbbb;
    stroke-width: 3;
    fill: none;
  }

  /* Light theme override */
  @media (prefers-color-scheme: light) {
    .gefi-node {
      fill: #f9f9f9 !important;
      stroke: #444444 !important;
    }
    .gefi-text {
      fill: #111111 !important;
    }
    .gefi-arrow {
      stroke: #555555 !important;
    }
  }
</style>

<div class="gefi-workflow-wrapper">
<svg class="gefi-workflow-svg" viewBox="0 0 1200 320" preserveAspectRatio="xMidYMid meet">
  <defs>
    <marker id="arrowhead" markerWidth="12" markerHeight="10" refX="10" refY="5" orient="auto">
      <path d="M0,0 L10,5 L0,10 Z" fill="currentColor"/>
    </marker>
  </defs>

  <!-- ========== NODES ========== -->
  <rect x="40" y="80" width="260" height="70" rx="16" class="gefi-node"/>
  <text x="170" y="108" text-anchor="middle" class="gefi-text" style="font-size:22px; font-weight:600;">Local Clients</text>
  <text x="170" y="135" text-anchor="middle" class="gefi-text" style="font-size:15px; opacity:0.9;">(Train privately on-device)</text>

  <rect x="380" y="80" width="260" height="70" rx="16" class="gefi-node"/>
  <text x="510" y="108" text-anchor="middle" class="gefi-text" style="font-size:22px; font-weight:600;">Secure Aggregation</text>
  <text x="510" y="135" text-anchor="middle" class="gefi-text" style="font-size:15px; opacity:0.9;">(HE + DP + ZKPs)</text>

  <rect x="740" y="80" width="260" height="70" rx="16" class="gefi-node"/>
  class="gefi-node"/>
  <text x="870" y="108" text-anchor="middle" class="gefi-text" style="font-size:22px; font-weight:600;">Global Model Update</text>
  <text x="870" y="135" text-anchor="middle" class="gefi-text" style="font-size:15px; opacity:0.9;">(FedAvg / FedProx)</text>

  <rect x="380" y="200" width="260" height="70" rx="16" class="gefi-node"/>
  <text x="510" y="228" text-anchor="middle" class="gefi-text" style="font-size:22px; font-weight:600;">Model Marketplace</text>
  <text x="510" y="255" text-anchor="middle" class="gefi-text" style="font-size:15px; opacity:0.9;">Incentives & Monetization</text>

  <!-- ========== ARROWS ========== -->
  <!-- Top row flow -->
  <line x1="300" y1="115" x2="380" y2="115" class="gefi-arrow" marker-end="url(#arrowhead)"/>
  <line x1="640" y1="115" x2="740" y2="115" class="gefi-arrow" marker-end="url(#arrowhead)"/>

  <!-- Global Model → Marketplace -->
  <line x1="870" y1="115" x2="870" y2="200" class="gefi-arrow" marker-end="url(#arrowhead)"/>

  <!-- Marketplace → Local Clients (bidirectional part 1) -->
  <line x1="510" y1="235" x2="380" y2="235" class="gefi-arrow" marker-end="url(#arrowhead)"/>
  <line x1="380" y1="235" x2="300" y2="150" class="gefi-arrow" marker-end="url(#arrowhead)"/>
  <line x1="300" y1="150" x2="170" y2="115" class="gefi-arrow" marker-end="url(#arrowhead)"/>

  <!-- Local Clients → Marketplace (bidirectional part 2) -->
  <line x1="170" y1="115" x2="300" y2="150" class="gefi-arrow" marker-end="url(#arrowhead)"/>
  <line x1="300" y1="150" x2="380" y2="235" class="gefi-arrow" marker-end="url(#arrowhead)"/>
  <line x1="380" y1="235" x2="510" y2="235" class="gefi-arrow" marker-end="url(#arrowhead)"/>
</svg>
</div>